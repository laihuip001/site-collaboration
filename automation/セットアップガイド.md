# 🛠️ セットアップガイド: 図面自動共有システム

このガイドに従って設定を行うと、Google Driveに図面を置くだけで、GitHubの最新図面リストが自動更新されるようになります。

---

## 📋 準備するもの（チェックリスト）

- [ ] Google アカウント（Drive, スプレッドシートを使用）
- [ ] GitHub アカウント
- [ ] (任意) LINE アカウント（通知用）

---

## ステップ 1: Google Drive の準備

### 1-1. 「Release」フォルダを作成

1.  Google Drive を開く
2.  「新規」→「フォルダ」をクリック
3.  フォルダ名: `Release` (または任意の名前)
4.  作成したフォルダを開き、**URLの末尾にあるIDをコピー**
    *   例: `https://drive.google.com/drive/folders/1a2b3c4d5e6f7g8h` の `1a2b3c4d5e6f7g8h` 部分

> 📝 メモ: このIDを後で `config.gs` の `RELEASE_FOLDER_ID` に設定します。

### 1-2. 共有設定（オプション）

現場監督がDriveリンクから直接ファイルを開けるようにするため:
1.  フォルダを右クリック →「共有」→「リンクをコピー」
2.  「リンクを知っている全員」を「閲覧者」に設定

---

## ステップ 2: Google スプレッドシートの準備

1.  Google スプレッドシートを新規作成
2.  シート名を「図面台帳」に変更 (またはデフォルトのまま、config.gs で指定)
3.  **URLからスプレッドシートIDをコピー**
    *   例: `https://docs.google.com/spreadsheets/d/XXXXXX/edit` の `XXXXXX` 部分

> 📝 メモ: このIDを後で `config.gs` の `SPREADSHEET_ID` に設定します。

---

## ステップ 3: GitHub リポジトリの準備

### 3-1. リポジトリ作成

1.  GitHub にログイン
2.  「New Repository」をクリック
3.  リポジトリ名を入力（例: `site-collaboration`）
4.  「Create repository」をクリック

### 3-2. テンプレートファイルをPush

ローカルのテンプレートフォルダ (`現場連携プロジェクトTemplate`) をGitHubにPushします。

```powershell
# テンプレートフォルダに移動
cd "c:/Users/laihuip001/開発（太郎）/現場連携プロジェクトTemplate"

# Git初期化
git init
git add .
git commit -m "Initial commit: Site collaboration template"

# リモートを追加してPush（URLは実際のリポジトリに置き換え）
git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
git branch -M main
git push -u origin main
```

### 3-3. Personal Access Token (PAT) の発行

> ⚠️ **重要:** このトークンはパスワードと同等です。絶対に他人に共有しないでください。

1.  GitHub にログイン
2.  右上のプロフィールアイコン →「Settings」
3.  左メニューの一番下「Developer settings」
4.  「Personal access tokens」→「Tokens (classic)」→「Generate new token (classic)」
5.  設定:
    *   **Note:** `GAS Sync Script` (任意のメモ)
    *   **Expiration:** 90 days (推奨) または No expiration
    *   **Scopes:** `repo` にチェック ✅
6.  「Generate token」をクリック
7.  **表示されたトークン（`ghp_xxxx...`）をすぐにコピー**（画面を離れると二度と見れません）

> 📝 メモ: このトークンを後で `config.gs` の `GITHUB_TOKEN` に設定します。

---

## ステップ 4: Google Apps Script の設定

### 4-1. Apps Script プロジェクトを作成

1.  [Google Apps Script](https://script.google.com/) を開く
2.  「新しいプロジェクト」をクリック
3.  プロジェクト名を設定（例: `図面同期スクリプト`）

### 4-2. スクリプトファイルを作成

1.  デフォルトの `コード.gs` を削除
2.  「＋」→「スクリプト」で以下の2ファイルを作成:
    *   `config` (拡張子 `.gs` は自動付与)
    *   `sync_to_github`
3.  `automation/gas/` フォルダ内の各ファイルの内容をコピー＆ペースト

### 4-3. config.gs を編集

コピーした `config.gs` 内の以下の項目を、実際の値に置き換えます:

```javascript
RELEASE_FOLDER_ID: '1a2b3c4d5e6f7g8h',  // ← ステップ1でコピーしたフォルダID
SPREADSHEET_ID: 'xxxxx',                 // ← ステップ2でコピーしたスプレッドシートID
GITHUB_OWNER: 'your-username',           // ← あなたのGitHubユーザー名
GITHUB_REPO: 'site-collaboration',       // ← リポジトリ名
GITHUB_TOKEN: 'ghp_xxxx...',             // ← ステップ3で発行したPAT
```

### 4-4. Drive API を有効化

1.  Apps Script エディタの左メニュー「サービス」の「＋」をクリック
2.  「Drive API」を選択し「追加」

### 4-5. トリガーを設定

1.  `sync_to_github.gs` 内の `setupTrigger` 関数を選択
2.  上部の「▶ 実行」ボタンをクリック
3.  初回は権限の承認を求められるので、すべて許可

これで5分ごとに自動同期が実行されます。

---

## ステップ 5: 動作確認

1.  `Release` フォルダにテスト用PDFをアップロード
    *   命名規則: `A-01_テスト図面.pdf`
2.  5分待つ（または `syncToGitHub` を手動実行）
3.  GitHubリポジトリの `docs/current_blueprints.md` が更新されていることを確認

---

## 🎉 完了！

これで設定は完了です。以降、`Release` フォルダにファイルを置くだけで、自動的に:
1.  スプレッドシート（図面台帳）が更新される
2.  GitHubの最新図面リストが更新される
3.  (設定していれば) LINE通知が届く

---

## トラブルシューティング

| 症状 | 原因と対処 |
| :--- | :--- |
| GitHubが更新されない | PATの有効期限切れ、または `repo` 権限がない可能性。再発行を試す。 |
| 「権限がありません」エラー | Drive APIが有効になっていない。サービス追加を確認。 |
| ファイルが認識されない | 命名規則（`X-00_タイトル.pdf`）に従っているか確認。 |
